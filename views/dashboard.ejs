<%- include('partials/header', { title: title, user: user }) %>

<style>
  body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding-top: 2rem;
    font-family: 'Inter', sans-serif;
  }
  
  .dashboard-card {
    background: rgba(255, 255, 255, 0.95);
    border: none;
    border-radius: 15px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    height: 100%;
  }
  
  .dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
  }
  
  .dashboard-icon {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    font-size: 2rem;
    color: white;
  }
  
  .dashboard-icon.primary { background: linear-gradient(45deg, #667eea, #764ba2); }
  .dashboard-icon.success { background: linear-gradient(45deg, #56ab2f, #a8e6cf); }
  .dashboard-icon.warning { background: linear-gradient(45deg, #ffa726, #fb8c00); }
  .dashboard-icon.danger { background: linear-gradient(45deg, #ef5350, #e53935); }
  .dashboard-icon.info { background: linear-gradient(45deg, #42a5f5, #1e88e5); }
</style>

<main class="container mt-5">
        <h1 class="mb-4">Welcome, <%= user.first_name ? user.first_name : user.username %>!</h1>
        
        <!-- Success Messages -->
        <% if (typeof success !== 'undefined' && success) { %>
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <%= success %>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        <% } %>

        <!-- Admin Role Debug Info (only show if needed) -->
        <% if (user && (!user.Role || user.Role.name !== 'admin')) { %>
            <div class="alert alert-warning" role="alert">
                <strong>Debug Info:</strong> 
                Role: <%= user.Role ? user.Role.name : 'No role loaded' %>
                <% if (!user.Role) { %>
                    - <button class="btn btn-sm btn-primary" id="refresh-session-btn">Refresh Session</button>
                <% } %>
            </div>
        <% } %>

        <!-- Management Cards -->
        <div class="row g-4 mb-4">
            <!-- Contacts Management -->
            <div class="col-12 col-md-6 col-lg-3">
                <div class="card dashboard-card h-100 text-center">
                    <div class="dashboard-icon primary">
                        <i class="fas fa-address-book"></i>
                    </div>
                    <h5 class="card-title">Contact Management</h5>
                    <p class="card-text">Manage your personal and business contacts</p>
                    <a href="/contacts" class="btn btn-primary">Manage Contacts</a>
                </div>
            </div>
            <!-- Files Management -->
            <div class="col-12 col-md-6 col-lg-3">
                <div class="card dashboard-card h-100 text-center">
                    <div class="dashboard-icon success">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <h5 class="card-title">File Management</h5>
                    <p class="card-text">Upload, organize, and manage your files</p>
                    <a href="/files" class="btn btn-success">Manage Files</a>
                </div>
            </div>
            <!-- Content Management -->
            <div class="col-12 col-md-6 col-lg-3">
                <div class="card dashboard-card h-100 text-center">
                    <div class="dashboard-icon warning">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <h5 class="card-title">Content Management</h5>
                    <p class="card-text">Manage your content and groups</p>
                    <a href="/content" class="btn btn-warning">Manage Content</a>
                </div>
            </div>
        </div>

        <!-- Second Row of Management Cards -->
        <div class="row g-4 mb-4">
            <!-- API Key Management -->
            <div class="col-12 col-md-6 col-lg-3">
                <div class="card dashboard-card h-100 text-center">
                    <div class="dashboard-icon danger">
                        <i class="fas fa-key"></i>
                    </div>
                    <h5 class="card-title">API Keys</h5>
                    <p class="card-text">Manage your API keys and permissions</p>
                    <a href="/api-keys" class="btn btn-danger">Manage API Keys</a>
                </div>
            </div>
            <!-- Subscription Management -->
            <div class="col-12 col-md-6 col-lg-3">
                <div class="card dashboard-card h-100 text-center">
                    <div class="dashboard-icon warning">
                        <i class="fas fa-crown"></i>
                    </div>
                    <h5 class="card-title">Subscription</h5>
                    <p class="card-text">Manage your subscription plan and billing</p>
                    <div class="d-grid gap-2">
                        <a href="/subscription/plans" class="btn btn-warning btn-sm">View Plans</a>
                        <a href="/subscription/manage" class="btn btn-outline-warning btn-sm">Manage</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Account Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Username:</strong> <%= user.username %></p>
                        <p><strong>Email:</strong> <%= user.email %></p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Subscription:</strong> 
                            <% if (subscription) { %>
                                <span class="badge bg-<%= subscription.status === 'active' ? 'success' : 'warning' %>">
                                    <%= subscription.subscriptionPlan.display_name %> - <%= subscription.status %>
                                </span>
                            <% } else { %>
                                <span class="badge bg-secondary">No Subscription</span>
                            <% } %>
                        </p>
                        <p><strong>Language:</strong> <%= user.language %></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Actions (if applicable) -->
        <% if (user && user.roleName === 'admin') { %>
        <div class="mb-4">
            <a href="/admin/users" class="btn btn-danger">Admin User Management</a>
        </div>
        <% } %>

    </main>

    <!-- Admin Session Fix Script -->
    <script src="/js/admin-session-fix.js?v=<%= Date.now() %>"></script>
    
    <!-- Dashboard specific scripts -->
    <script src="/js/dashboard.js?v=<%= Date.now() %>"></script>

<%- include('partials/footer') %> 